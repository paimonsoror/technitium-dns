# Production values for technitium-dns-server
# This is an example production configuration

replicaCount: 1

image:
  repository: technitium/dns-server
  pullPolicy: IfNotPresent
  tag: "latest"

# DNS Server Configuration
dnsServer:
  domain: "dns.production.example.com"
  # Leave empty for auto-generated password (recommended)
  adminPassword: ""
  preferIPv6: false
  webServiceHttpPort: 5380
  webServiceHttpsPort: 53443
  webServiceEnableHttps: true
  webServiceUseSelfSignedCert: false

  # Use Cloudflare and Google DNS as forwarders with TLS
  forwarders: "1.1.1.1, 8.8.8.8"
  forwarderProtocol: "Tls"

  # Enable ad blocking
  enableBlocking: true
  blockListUrls: "https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts,https://mirror1.malwaredomains.com/files/justdomains"

service:
  web:
    type: ClusterIP
    port: 5380
    annotations: {}

  dns:
    type: LoadBalancer
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    # Uncomment to request a specific IP
    # loadBalancerIP: "203.0.113.10"
    loadBalancerSourceRanges: []

  dnsTls:
    enabled: true
    type: LoadBalancer
    port: 853
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

  dnsHttps:
    enabled: true
    type: LoadBalancer
    port: 443
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: dns.production.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: dns-tls
      hosts:
        - dns.production.example.com

persistence:
  enabled: true
  storageClass: "gp3"
  accessMode: ReadWriteOnce
  size: 10Gi
  annotations: {}

resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "5380"

podSecurityContext:
  fsGroup: 1000

securityContext:
  capabilities:
    add:
    - NET_BIND_SERVICE
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: false
  runAsUser: 0

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - technitium-dns-server
        topologyKey: kubernetes.io/hostname

config:
  customConfigMap: {}
